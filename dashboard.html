<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OS Scheduler Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white flex h-screen">
    <div class="w-64 bg-gray-800 border-r border-gray-700 p-6 flex flex-col gap-2 overflow-y-auto">
        <h2 class="text-xl font-bold text-blue-400 mb-6 uppercase">Algorithms</h2>
        <button onclick="setAlgo(1, 'CFS')" class="p-3 text-left hover:bg-gray-700 rounded transition">CFS</button>
        <button onclick="setAlgo(2, 'EDF')" class="p-3 text-left hover:bg-gray-700 rounded transition">EDF</button>
        <button onclick="setAlgo(3, 'FCFS')" class="p-3 text-left hover:bg-gray-700 rounded transition">FCFS</button>
        <button onclick="setAlgo(4, 'MLFQ')" class="p-3 text-left hover:bg-gray-700 rounded transition">MLFQ</button>
        <button onclick="setAlgo(5, 'Priority')" class="p-3 text-left hover:bg-gray-700 rounded transition">Priority</button>
        <button onclick="setAlgo(6, 'PropShare')" class="p-3 text-left hover:bg-gray-700 rounded transition">PropShare</button>
        <button onclick="setAlgo(7, 'RMS')" class="p-3 text-left hover:bg-gray-700 rounded transition">RMS</button>
        <button onclick="setAlgo(8, 'RR')" class="p-3 text-left hover:bg-gray-700 rounded transition">RR</button>
        <button onclick="setAlgo(9, 'SJF')" class="p-3 text-left hover:bg-gray-700 rounded transition">SJF</button>
    </div>

    <div class="flex-1 p-8 overflow-y-auto">
        <header class="mb-8 flex justify-between items-center">
            <h1 id="algo-title" class="text-3xl font-bold text-blue-400">Select an Algorithm</h1>
            <div id="status" class="text-xs font-mono text-gray-500 italic">Ready</div>
        </header>

        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-8 shadow-xl">
            <table class="w-full text-left mb-4">
                <thead>
                    <tr class="text-gray-400 border-b border-gray-700 text-sm uppercase">
                        <th class="pb-2">PID</th> <th class="pb-2">Arrival</th> <th class="pb-2">Burst</th> <th class="pb-2">Priority</th>
                    </tr>
                </thead>
                <tbody id="rows"></tbody>
            </table>
            <div class="flex gap-4">
                <button onclick="addRow()" class="text-sm text-blue-400">+ Add Process</button>
                <button onclick="runSim()" class="bg-blue-600 px-6 py-2 rounded-lg font-bold hover:bg-blue-500 transition">Execute Simulation</button>
            </div>
        </div>

        <div id="gantt-sec" class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-8 hidden">
            <h3 class="text-lg mb-4 text-gray-300 font-bold uppercase tracking-widest">Gantt Timeline</h3>
            <div id="gantt" class="flex h-12 w-full bg-black rounded overflow-hidden shadow-inner"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><canvas id="bar"></canvas></div>
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><canvas id="radar"></canvas></div>
        </div>
    </div>

    <script>
        let selectedId = 1;
        let barChart, radarChart;

        function setAlgo(id, name) {
            selectedId = id;
            document.getElementById('algo-title').innerText = name + " Configuration";
            document.getElementById('rows').innerHTML = '';
            for(let i=0; i<3; i++) addRow();
        }

        function addRow() {
            const tbody = document.getElementById('rows');
            const row = `<tr>
                <td class="py-2"><input type="number" value="${tbody.rows.length+1}" class="bg-gray-900 border border-gray-700 p-1 w-16 rounded text-blue-400"></td>
                <td><input type="number" value="0" class="bg-gray-900 border border-gray-700 p-1 w-20 rounded"></td>
                <td><input type="number" value="5" class="bg-gray-900 border border-gray-700 p-1 w-20 rounded"></td>
                <td><input type="number" value="1" class="bg-gray-900 border border-gray-700 p-1 w-20 rounded"></td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        }

        async function runSim() {
            const status = document.getElementById('status');
            status.innerText = "Running...";
            
            const rows = document.querySelectorAll('#rows tr');
            const processes = Array.from(rows).map(r => {
                const inputs = r.querySelectorAll('input');
                return { pid: inputs[0].value, at: inputs[1].value, bt: inputs[2].value, priority: inputs[3].value };
            });

            try {
                const res = await fetch('http://localhost:5000/simulate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ algoId: selectedId, processes })
                });
                const data = await res.json();
                updateUI(data);
                status.innerText = "Complete";
            } catch (e) {
                status.innerText = "Error: Check Python";
                alert("Ensure app.py is running on port 5000");
            }
        }

        function updateUI(data) {
            document.getElementById('gantt-sec').classList.remove('hidden');
            const gantt = document.getElementById('gantt');
            gantt.innerHTML = '';
            let total = 0; data.processes.forEach(p => total += p.bt);
            
            data.processes.forEach(p => {
                const block = document.createElement('div');
                block.style.width = (p.bt/total*100) + '%';
                block.style.backgroundColor = `hsl(${(p.pid*137)%360}, 60%, 50%)`;
                block.className = "h-full flex items-center justify-center text-[10px] font-bold border-r border-black";
                block.innerText = 'P' + p.pid;
                gantt.appendChild(block);
            });

            if (barChart) barChart.destroy();
            barChart = new Chart(document.getElementById('bar'), {
                type: 'bar',
                data: {
                    labels: data.processes.map(p => 'P'+p.pid),
                    datasets: [{ label: 'Wait Time', data: data.processes.map(p => p.wt), backgroundColor: '#34d399' }]
                }
            });
        }
        setAlgo(1, 'CFS');
    </script>
</body>
</html>